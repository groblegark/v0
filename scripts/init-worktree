#!/usr/bin/env bash
# SPDX-License-Identifier: MIT
# Copyright (c) 2026 Alfred Jean LLC
# scripts/init-worktree - Initialize a v0 worktree with cached dependencies
#
# Called by V0_WORKTREE_INIT hook in .v0.rc after worktree creation.
# Environment variables (set by v0-tree):
#   V0_CHECKOUT_DIR - Path to the main project checkout
#   V0_WORKTREE_DIR - Path to the new worktree directory

set -euo pipefail

checkout="${V0_CHECKOUT_DIR:?V0_CHECKOUT_DIR not set}"
worktree="${V0_WORKTREE_DIR:?V0_WORKTREE_DIR not set}"

# Copy test fixtures to worktree if present in main checkout
FIXTURES_SRC="${checkout}/packages/test-support/fixtures"
FIXTURES_DST="${worktree}/packages/test-support/fixtures"

if [[ -f "${FIXTURES_SRC}/git-repo.tar" && ! -f "${FIXTURES_DST}/git-repo.tar" ]]; then
    echo "Copying test fixtures to worktree..."
    mkdir -p "${FIXTURES_DST}"
    cp "${FIXTURES_SRC}/git-repo.tar" "${FIXTURES_DST}/"
fi
